### Test API Endpoints for Financial & Assessment Features
### Install "REST Client" extension in VS Code to run these requests

@baseUrl = https://tndsystem.online/backend-web
@token = your_auth_token_here

### ============================================
### Test 1: Create Visit with Crew
### ============================================
POST {{baseUrl}}/api/visits-create.php
Content-Type: application/json

{
  "outlet_id": 1,
  "crew_in_charge": "John Doe - Test Crew"
}

### ============================================
### Test 2: Get Visit Detail (should return new fields)
### ============================================
GET {{baseUrl}}/api/visit-detail.php?visit_id=1

### ============================================
### Test 3: Update Financial Data Only
### ============================================
POST {{baseUrl}}/api/visit-update-financial.php
Content-Type: application/json

{
  "visit_id": 1,
  "uang_omset_modal": 5000000,
  "uang_ditukar": 500000,
  "cash": 2000000,
  "qris": 1500000,
  "debit_kredit": 1000000
}

### Expected: total should be auto-calculated = 10000000

### ============================================
### Test 4: Update Assessment Data Only
### ============================================
POST {{baseUrl}}/api/visit-update-financial.php
Content-Type: application/json

{
  "visit_id": 1,
  "kategoric": "minor",
  "leadtime": 30,
  "status_keuangan": "open"
}

### ============================================
### Test 5: Update Both Financial & Assessment
### ============================================
POST {{baseUrl}}/api/visit-update-financial.php
Content-Type: application/json

{
  "visit_id": 1,
  "uang_omset_modal": 3000000,
  "cash": 1000000,
  "qris": 500000,
  "kategoric": "major",
  "leadtime": 45,
  "status_keuangan": "close",
  "crew_in_charge": "Jane Smith"
}

### ============================================
### Test 6: Validation - Invalid kategoric
### ============================================
POST {{baseUrl}}/api/visit-update-financial.php
Content-Type: application/json

{
  "visit_id": 1,
  "kategoric": "invalid_value"
}

### Expected: Error 400 - Invalid kategoric value

### ============================================
### Test 7: Validation - Invalid status
### ============================================
POST {{baseUrl}}/api/visit-update-financial.php
Content-Type: application/json

{
  "visit_id": 1,
  "status_keuangan": "pending"
}

### Expected: Error 400 - Invalid status_keuangan value

### ============================================
### Test 8: Partial Update (only cash)
### ============================================
POST {{baseUrl}}/api/visit-update-financial.php
Content-Type: application/json

{
  "visit_id": 1,
  "cash": 2500000
}

### Expected: Only cash and total should be updated

### ============================================
### Test 9: Get All Visits (check if new fields included)
### ============================================
GET {{baseUrl}}/api/visits.php

### ============================================
### Test 10: Complete Flow
### ============================================

# Step 1: Create visit
POST {{baseUrl}}/api/visits-create.php
Content-Type: application/json

{
  "outlet_id": 1,
  "crew_in_charge": "Complete Flow Test"
}

###

# Step 2: Update financial (use visit_id from step 1)
POST {{baseUrl}}/api/visit-update-financial.php
Content-Type: application/json

{
  "visit_id": 1,
  "uang_omset_modal": 5000000,
  "uang_ditukar": 1000000,
  "cash": 2000000,
  "qris": 1500000,
  "debit_kredit": 500000
}

###

# Step 3: Update assessment
POST {{baseUrl}}/api/visit-update-financial.php
Content-Type: application/json

{
  "visit_id": 1,
  "kategoric": "major",
  "leadtime": 60,
  "status_keuangan": "close"
}

###

# Step 4: Get final result
GET {{baseUrl}}/api/visit-detail.php?visit_id=1

###
